<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>üèÜ Today's MVP Award üéâ</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="is-signed-out">
    <main class="app">
      <header class="top-bar" aria-live="polite">
        <div class="top-bar-left">
          <div class="auth-panel">
            <button id="loginBtn" class="btn login-btn" type="button" aria-label="Sign in with Google">Sign in with Google</button>
            <button id="settingsBtn" class="btn btn-secondary settings-btn" type="button" aria-label="Open user settings" hidden>Settings</button>
          </div>
          <div class="class-picker-wrap">
            <select id="classSelector" class="class-picker" hidden aria-label="Select class"></select>
          </div>
        </div>
        <div class="top-bar-right">
          <button id="helpBtn" class="btn btn-secondary help-btn" type="button" aria-label="Open help">Help</button>
        </div>
      </header>
      <h1 class="title">üèÜ Today's MVP Award üéâ</h1>
      <aside class="weekly" id="weeklyBox" aria-live="polite">
        <h2 class="weekly-title">Weekly Winners</h2>
        <div class="weekly-head" role="presentation">
          <div class="col-week">Week</div>
          <div class="col-name">Name</div>
        </div>
        <ol id="weeklyList" class="weekly-list weekly-table" aria-label="Weekly winners"></ol>
      </aside>

      <div class="left-col">
        <div class="board-wrap">
          <div id="board" class="board" aria-live="polite" aria-atomic="true">READY</div>
        </div>
        <button id="startBtn" class="btn start-btn-large" type="button" aria-label="Start shuffling and pick a name">Start</button>
        <div class="minor-controls">
          <button id="setWinnerBtn" class="btn btn-secondary btn-sm" type="button" aria-label="Set the winner name" title="Set Winner">üèÜ</button>
          <button id="clearWeeklyBtn" class="btn btn-secondary btn-sm" type="button" aria-label="Reset weekly winners">Reset Weekly Winners</button>
        </div>
        <div class="sub-controls" aria-label="Shuffle time control">
          <label for="shuffleRange" class="sub-label">Shuffle Time</label>
          <input id="shuffleRange" type="range" min="1" max="10" step="1" value="5" />
          <span id="shuffleValue" class="sub-value">5s</span>
        </div>
        <p id="classUsageNotice" class="class-usage" hidden></p>
        <p class="hint" id="winnerStatus" aria-live="polite"></p>
        <p class="site-footer">¬© 2025 Developed by <a href="https://thugmba.github.io/ialab/" target="_blank" rel="noopener">Innovation Analytics Laboratory</a> at Tunghai University</p>

        <div id="confirmResetPanel" class="reset-panel" hidden>
          <div class="reset-panel-card" role="dialog" aria-modal="true" aria-labelledby="resetDialogTitle">
            <h2 class="dialog-title" id="resetDialogTitle">Reset Weekly Winners</h2>
            <p class="dialog-subtitle">Clear all saved winners for this class? This cannot be undone.</p>
            <div class="dialog-actions">
              <button type="button" id="cancelResetBtn" class="btn btn-secondary btn-sm">Cancel</button>
              <button type="button" id="confirmResetBtn" class="btn btn-danger btn-sm">Reset</button>
            </div>
          </div>
        </div>

        <div id="confirmWeeklyRemovalPanel" class="reset-panel" hidden>
          <div class="reset-panel-card" role="dialog" aria-modal="true" aria-labelledby="removeDialogTitle">
            <h2 class="dialog-title" id="removeDialogTitle">Remove Weekly Winner</h2>
            <p class="dialog-subtitle" id="removeDialogSubtitle">Remove this entry from the weekly winners timeline?</p>
            <p class="dialog-highlight" id="removeDialogWinner"></p>
            <div class="dialog-actions">
              <button type="button" id="cancelWeeklyRemovalBtn" class="btn btn-secondary btn-sm">Cancel</button>
              <button type="button" id="confirmWeeklyRemovalBtn" class="btn btn-danger btn-sm">Remove</button>
            </div>
          </div>
        </div>
      </div>

      <dialog id="namesDialog" class="dialog">
        <form method="dialog" class="dialog-body" id="namesForm" novalidate>
          <h2 class="dialog-title">Set Names</h2>
          <p class="dialog-subtitle">Paste names below, one per line. Blank lines are ignored.</p>
          <textarea id="namesTextarea" class="dialog-textarea" rows="10" placeholder="Alice\nBob\nCharlie"></textarea>
          <div class="dialog-actions">
            <button type="button" id="cancelNamesBtn" class="btn btn-secondary">Cancel</button>
            <button type="button" id="saveNamesBtn" class="btn">Save</button>
          </div>
        </form>
      </dialog>

      <dialog id="winnerDialog" class="dialog">
        <form method="dialog" class="dialog-body" id="winnerForm">
          <h2 class="dialog-title">Select Winner</h2>
          <p class="dialog-subtitle">Choose the predefined winner. Click a name below.</p>
          <div id="winnerGrid" class="name-grid"></div>
          <div class="dialog-actions">
            <button type="button" id="cancelWinnerBtn" class="btn btn-secondary btn-sm">Close</button>
          </div>
        </form>
      </dialog>

      <dialog id="settingsDialog" class="dialog settings-dialog">
        <form method="dialog" class="dialog-body settings-body" id="settingsForm">
          <h2 class="dialog-title">Classes</h2>
          <p class="dialog-subtitle">Manage your classes and student lists.</p>
          <div class="settings-columns">
            <section class="class-list-panel">
              <div id="classList" class="class-list" aria-live="polite" role="listbox" aria-label="Classes"></div>
            </section>
          </div>
          <fieldset id="settingsAddFieldset" class="settings-add" hidden>
            <legend>Add New Class</legend>
            <label class="settings-label" for="classNameInput">Course Name</label>
            <input id="classNameInput" class="settings-input" type="text" placeholder="Intro to Robotics" />
            <label class="settings-label" for="studentListTextarea">Student List</label>
            <textarea id="studentListTextarea" class="settings-textarea" rows="6" placeholder="Alice&#10;Bob&#10;Charlie"></textarea>
          </fieldset>
          <div class="dialog-actions settings-actions">
            <button type="button" id="closeSettingsBtn" class="btn btn-secondary">Back</button>
            <button type="button" id="addClassBtn" class="btn btn-sm">Add Class</button>
          </div>
        </form>
      </dialog>

      <dialog id="classEditDialog" class="dialog class-edit-dialog" aria-labelledby="classEditTitle">
        <form method="dialog" class="dialog-body">
          <h2 id="classEditTitle" class="dialog-title">Edit Class</h2>
          <p class="dialog-subtitle">Update the student list. Enter one student per line.</p>
          <label class="settings-label" for="classEditTextarea">Student List</label>
          <textarea id="classEditTextarea" class="settings-textarea class-edit-textarea" rows="8" placeholder="Alice&#10;Bob&#10;Charlie"></textarea>
          <p id="classEditMessage" class="settings-message" hidden></p>
          <div class="dialog-actions">
            <button type="button" id="classEditCancelBtn" class="btn btn-secondary btn-sm">Cancel</button>
            <button type="button" id="classEditSaveBtn" class="btn btn-sm">Save</button>
          </div>
        </form>
      </dialog>

      <dialog id="classDeleteDialog" class="dialog class-delete-dialog" aria-labelledby="classDeleteTitle">
        <form method="dialog" class="dialog-body">
          <h2 id="classDeleteTitle" class="dialog-title">Delete Class</h2>
          <p id="classDeleteMessage" class="settings-message"></p>
          <div class="dialog-actions">
            <button type="button" id="classDeleteCancelBtn" class="btn btn-secondary btn-sm">Cancel</button>
            <button type="button" id="classDeleteConfirmBtn" class="btn btn-danger btn-sm">Delete</button>
          </div>
        </form>
      </dialog>

    </main>
    <div id="qrOverlay" class="qr-overlay" hidden aria-hidden="true" tabindex="-1">
      <div class="qr-overlay-card" role="dialog" aria-modal="true" aria-labelledby="qrOverlayTitle">
        <h2 class="qr-overlay-title" id="qrOverlayTitle">Scan to Open MVP</h2>
        <img src="MVP_qr.png" alt="QR code that links to the MVP app" class="qr-overlay-image" />
        <p class="qr-overlay-hint">Press Esc to close</p>
      </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script>
      window.FIREBASE_CONFIG = window.FIREBASE_CONFIG || {
        apiKey: "AIzaSyD225v6FB15Syii_UGlulV-ttbQT1A7zF8",
        authDomain: "thumvp-3238b.firebaseapp.com",
        projectId: "thumvp-3238b",
        storageBucket: "thumvp-3238b.firebasestorage.app",
        messagingSenderId: "330875315451",
        appId: "1:330875315451:web:31de5dea1594bbb9047c5e",
        measurementId: "G-YNW7FKETH3"
      };
    </script>
    <script src="app.js"></script>
  </body>
  </html>
